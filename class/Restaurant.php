<?php/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. *//** * Description of restaurant * * @author chalana */class Restaurant {    public $id;    public $customer_id;    public $title;    public $address_1;    public $address_2;    public $city;    public $contact_name;    public $email;    public $contact_number;    public $contact_number_2;    public $main_image;    public $serve_types;    public $open_time;    public $close_time;    public $close_days;    public $description;    public $is_publish;    public $queue;    public function __construct($id) {        if ($id) {            $query = "SELECT  * FROM `restaurant` WHERE `id`=" . $id;            $db = new Database();            $result = mysqli_fetch_array($db->readQuery($query));            $this->id = $result['id'];            $this->customer_id = $result['customer_id'];            $this->title = $result['title'];            $this->address_1 = $result['address_1'];            $this->address_2 = $result['address_2'];            $this->city = $result['city'];            $this->contact_name = $result['contact_name'];            $this->email = $result['email'];            $this->contact_number = $result['contact_number'];            $this->contact_number_2 = $result['contact_number_2'];            $this->main_image = $result['main_image'];            $this->serve_types = $result['serve_types'];            $this->open_time = $result['open_time'];            $this->close_time = $result['close_time'];            $this->close_days = $result['close_days'];            $this->description = $result['description'];            $this->is_publish = $result['is_publish'];            $this->queue = $result['queue'];            return $this;        }    }    public function create() {        $query = "INSERT INTO `restaurant` (`customer_id`,`title`,`address_1`,`address_2`,`city`,`email`,`contact_name` ,`contact_number`,`contact_number_2`,`main_image`,"                . "`serve_types`, `open_time`,`close_time`,`close_days`,`description`,`is_publish`,`queue`) VALUES  ('"                . $this->customer_id . "','"                . $this->title . "','"                . $this->address_1 . "','"                . $this->address_2 . "','"                . $this->city . "','"                . $this->email . "','"                . $this->contact_name . "','"                . $this->contact_number . "','"                . $this->contact_number_2 . "','"                . $this->main_image . "','"                . $this->serve_types . "','"                . $this->open_time . "','"                . $this->close_time . "','"                . $this->close_days . "','"                . $this->description . "', '"                . $this->is_publish . "', '"                . $this->queue . "')";        $db = new Database();        $result = $db->readQuery($query);        if ($result) {            return mysqli_insert_id($db->DB_CON);        } else {            return FALSE;        }    }    public function all() {        $query = "SELECT * FROM `restaurant` ORDER BY queue ASC";        $db = new Database();        $result = $db->readQuery($query);        $array_res = array();        while ($row = mysqli_fetch_array($result)) {            array_push($array_res, $row);        }        return $array_res;    }    public function getRestaurantByPublished() {        $query = "SELECT * FROM `restaurant` WHERE `is_publish`= 1 ORDER BY queue ASC";        $db = new Database();        $result = $db->readQuery($query);        $array_res = array();        while ($row = mysqli_fetch_array($result)) {            array_push($array_res, $row);        }        return $array_res;    }    public function getRestaurantByNotPublished() {         $query = "SELECT * FROM `restaurant` WHERE `is_publish`= 0 ORDER BY queue ASC";         $db = new Database();         $result = $db->readQuery($query);        $array_res = array();         while ($row = mysqli_fetch_array($result)) {            array_push($array_res, $row);        }        return $array_res;    }    public function updateCompanyActive() {        $query = "UPDATE  `restaurant` SET "                 . "`is_publish` ='" . $this->is_publish . "' "                . "WHERE `id` = '" . $this->id . "'";        $db = new Database();        $result = $db->readQuery($query);        if ($result) {            return $this->__construct($this->id);        } else {            return FALSE;        }    }    public function getAllByFilter($restaurant_type, $feature, $district, $pageLimit, $setLimit) {        $query = "SELECT *   FROM `restaurant`  WHERE ";        if (!empty($restaurant_type)) {            $restaurant_type_filter = implode(",", $restaurant_type);            $query .= "restaurant.type in( " . $restaurant_type_filter . ")  AND ";        }//        if (!empty($open_time)) {//            $open_time_filter = implode(",", $open_time);//            $query .= "restaurant.open_time in( " . $open_time_filter . ")  AND ";//        }                if (!empty($feature)) {            $feature_filter = implode(",", $feature);            $query .= "rent_a_car_feature.feature in( " . $feature_filter . ")  AND ";        }                if (!empty($districts)) {            $district_filter = implode(",", $districts);            $query .= "restaurant.district in( " . $district_filter . ")  AND ";        }                $query .= "restaurant.is_publish = 1  ORDER BY restaurant.queue ASC LIMIT " . $pageLimit . " , " . $setLimit;               $db = new Database();        $result = $db->readQuery($query);        $out_put = '';        $out_put .= '';        while ($row = mysqli_fetch_array($result)) {                        $RENT_CARS = new RentCar(NULL);            $RENT_CAR_PRICE = new RentCarPrice(NULL);            $DEFULTDATA = new DefaultData(NULL);            $out_put .= ' <div class="product-long-item">                                                <div class="row equal-height shrink-auto-md gap-15">                                                    <div class="col-12 col-shrink">                                                       <a href="view-rent-car-package.php?id=' . $row['id'] . '" >                                                        <div class="image height-auto">                                                            <img src="upload/restaurant/main/gallery/thumb/' . $row['main_image'] . '" alt="' . $row['title'] . '" />                                                        </div>                                                        </a>                                                    </div>                                                    <div class="col-12 col-auto">                                                        <div class="col-inner d-flex flex-column">                                                            <div   lass="mb-5">                                                                <div class="d-flex">                                                                    <div>                                                                        <div class="rating-item rating-sm">                                                                            <div class="rating-icons">                                                                                <p class="rating-text text-muted">                                                                                      <span class="material-icons star-size-1">    star   </span>                                                                                 <span class="bg-primary">6.0</span>                                                                                 <strong class="text-dark">Good</strong> <span class="font13">- 1,2547 reviews</span></p>                                                                              </div>                                                                        </div>                                                                        <h5><a href="view-rent-car-package.php?id=' . $row['id'] . '">' . $row['title'] . '</a></h5>                                                                        <p class = "location"><i class = "fas fa-map-marker-alt text-primary"></i>' . substr($row['city'], 0, 40) . '..</p>                                                                    </div>                                                                    <div class="ml-auto">                                                                        <div class="price ">                                                                            start from';            $min_price = $RENT_CAR_PRICE->getMinPriceByCompany($row['id']);            foreach ($min_price as $min) {                $out_put .= ' <span class="text-secondary f-14">';                foreach ($DEFULTDATA->GetCurrancyType() as $key => $curancy) {                    if ($min['currency_type'] == $key) {                        $out_put .= $curancy . ' ' . $min['min_prce'] . '</span>';                    }                }            }            $out_put .= '  per package                                                                        </div>                                                                      </div>                                                                </div>                                                            </div>                                                            <div class="mb-5 mt-5">                                                               ' . substr($row['description'], 0, 115) . '...                                                             </div>                                                            <div class="content-bottom mt-auto">                                                                <div class="d-flex align-items-center">                                                                    <div>                                                                        <ul class="meta-list">';            $out_put .= '<li>' . $row['close_days'] . ' doors</li>'                    . ' <li>' . $row['num_passengers'] . ' seats</li>'                    . ' <li>' . $row['num_baggaes'] . ' baggages</li>';            $out_put .= ' </ul>                                                                    </div>                                                                    <div class="ml-auto">                                                                        <a href="view-rent-car-package.php?id=' . $row['id'] . '" class="btn btn-primary btn-sm btn-wide">Details</a>                                                                    </div>                                                                </div>                                                            </div>                                                        </div>                                                    </div>                                                </div>                                                </div> ';        }        $out_put .= '';        if (!empty($out_put)) {            echo $out_put;        } else {            echo $out_put = '<p style = "color: red;font-weight: 600;">No Data Found..!</p>';        }    }    public function showPagination($per_page, $page) {        $query = "SELECT COUNT(*) as totalCount FROM `restaurant` WHERE   `is_publish` = 1  ORDER BY `queue` asc";        $db = new Database();        $page_url = "?";        $rec = mysqli_fetch_array(mysql_query($query));        $total = $rec['totalCount'];        $adjacents = "2";        $page = ($page == 0 ? 1 : $page);        $start = ($page - 1) * $per_page;        $first = $start + 1;        $last = $start + $per_page;        $prev = $page - 1;        $next = $page + 1;        $setLastpage = ceil($total / $per_page);        $lpm1 = $setLastpage - 1;        $setPaginate = "";        $setPaginate .= "<div class='setPage'>Showing result $first to $last from $total</div>";        if ($setLastpage > 1) {            $setPaginate .= "<ul class='setPaginate'>";            if ($page > 1) {                $setPaginate.= "<li><a href='#' class='page' page='$prev'>&laquo;</a></li>";            } else {                $setPaginate.= "<li><a class='current_page1 page'>&laquo;</a></li>";            }            if ($setLastpage < 7 + ($adjacents * 2)) {                for ($counter = 1; $counter <= $setLastpage; $counter++) {                    if ($counter == $page)                        $setPaginate.= "<li><a class='current_page  '>$counter</a></li>";                    else                        $setPaginate.= "<li><a href='#' class='page' page='$counter'>$counter</a></li>";                }            }            elseif ($setLastpage > 5 + ($adjacents * 2)) {                if ($page < 1 + ($adjacents * 2)) {                    for ($counter = 1; $counter < 4 + ($adjacents * 2); $counter++) {                        if ($counter == $page)                            $setPaginate.= "<li><a class='current_page page'>$counter</a></li>";                        else                            $setPaginate.= "<li><a href='#' class='page' page='$counter'>$counter</a></li>";                    }                    $setPaginate.= "<li class='dot'>...</li>";                    $setPaginate.= "<li><a href='#' class='page' page='$lpm1'>$lpm1</a></li>";                    $setPaginate.= "<li><a href='#' class='page' page='$setLastpage'>$setLastpage</a></li>";                }                elseif ($setLastpage - ($adjacents * 2) > $page && $page > ($adjacents * 2)) {                    $setPaginate.= "<li><a href='#' class='page' page='1'>1</a></li>";                    $setPaginate.= "<li><a href='#' class='page' page='2'>2</a></li>";                    $setPaginate.= "<li class='dot'>...</li>";                    for ($counter = $page - $adjacents; $counter <= $page + $adjacents; $counter++) {                        if ($counter == $page)                            $setPaginate.= "<li><a class='current_page page'>$counter</a></li>";                        else                            $setPaginate.= "<li><a href='#' class='page' page='$counter'>$counter</a></li>";                    }                    $setPaginate.= "<li class='dot'>..</li>";                    $setPaginate.= "<li><a href='#' class='page' page='$lpm1'>$lpm1</a></li>";                    $setPaginate.= "<li><a href='#' class='page' page='$setLastpage'>$setLastpage</a></li>";                }                else {                    $setPaginate.= "<li><a href='#' class='page' page='1>1</a></li>";                    $setPaginate.= "<li><a href='#' class='page' page='2'>2</a></li>";                    $setPaginate.= "<li class='dot'>..</li>";                    for ($counter = $setLastpage - (2 + ($adjacents * 2)); $counter <= $setLastpage; $counter++) {                        if ($counter == $page)                            $setPaginate.= "<li><a class='current_page page'>$counter</a></li>";                        else                            $setPaginate.= "<li><a href='#' class='page' page='$counter'>$counter</a></li>";                    }                }            }            if ($page < $counter - 1) {                $setPaginate.= "<li><a href='#' class='page' page='$next'>&raquo;</a></li>";            } else {                $setPaginate.= "<li><a class='current_page1 page'>&raquo;</a></li>";            }            $setPaginate.= "</ul>\n";        }        echo $setPaginate;    }    public function getRestaurantByCustomer($id) {        $query = "SELECT * FROM `restaurant` WHERE `customer_id`= $id ORDER BY queue ASC";        $db = new Database();        $result = $db->readQuery($query);        $array_res = array();        while ($row = mysqli_fetch_array($result)) {            array_push($array_res, $row);        }        return $array_res;    }    public function update() {        $query = "UPDATE  `restaurant` SET "                . "`title` ='" . $this->title . "', "                . "`address_1` ='" . $this->address_1 . "', "                . "`address_2` ='" . $this->address_2 . "', "                . "`city` ='" . $this->city . "', "                . "`contact_name` ='" . $this->contact_name . "', "                . "`contact_number` ='" . $this->contact_number . "', "                . "`contact_number_2` ='" . $this->contact_number_2 . "', "                . "`main_image` ='" . $this->main_image . "', "                . "`serve_types` ='" . $this->serve_types . "', "                . "`open_time` ='" . $this->open_time . "', "                . "`contact_name` ='" . $this->contact_name . "', "                . "`close_time` ='" . $this->close_time . "', "                . "`close_days` ='" . $this->close_days . "', "                . "`description` ='" . $this->description . "', "                . "`queue` ='" . $this->queue . "' "                . "WHERE `id` = '" . $this->id . "'";        $db = new Database();        $result = $db->readQuery($query);        if ($result) {            return $this->__construct($this->id);        } else {            return FALSE;        }    }    public function updateLocation() {        $query = "UPDATE  `restaurant` SET "                . "`description` ='" . $this->description . "', "                . "`map` ='" . $this->map . "', "                . "`location` ='" . $this->location . "', "                . "`isPublished` ='" . $this->isPublished . "' "                . "WHERE `id` = '" . $this->id . "'";        $db = new Database();        $result = $db->readQuery($query);        if ($result) {            return $this->__construct($this->id);        } else {            return FALSE;        }    }    public function delete() {        $this->deletePhotos();        $RENT_CAR_PRICE = new RentCarPrice(NULL);        $RENT_CAR_PRICE->deleteAll($this->id);        $query = 'DELETE FROM `restaurant` WHERE id = "' . $this->id . '"';        $db = new Database();        return $db->readQuery($query);    }    public function deletePhotos() {        $RENT_CAR_PHOTO = new RentCarPhoto(NULL);        $allPhotos = $RENT_CAR_PHOTO->getCarPhotosById($this->id);        foreach ($allPhotos as $photo) {            $IMG = $RENT_CAR_PHOTO->image_name = $photo["image_name"];            unlink(Helper::getSitePath() . "upload/rent-a-car/gallery/" . $IMG);            unlink(Helper::getSitePath() . "upload/rent-a-car/gallery/thumb/" . $IMG);            $RENT_CAR_PHOTO->id = $photo["id"];            $RENT_CAR_PHOTO->delete();        }    }    public function arrange($key, $img) {        $query = "UPDATE `restaurant` SET `queue` = '" . $key . "'  WHERE id = '" . $img . "'";        $db = new Database();        $result = $db->readQuery($query);        return $result;    }    public function getActivitiesByTitle($title) {        $query = "SELECT `id` FROM `restaurant` WHERE `title` LIKE '" . $title . "'";        $db = new Database();        $result = mysqli_fetch_array($db->readQuery($query));        return $result['id'];    }}